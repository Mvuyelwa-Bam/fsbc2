<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="A quirky and cool sci-fi birthday web app for Teboho!"
    />
    <title>Happy Birthday, Teboho!</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Custom styles for animations and scrollbar */
        .font-inter {
          font-family: 'Inter', sans-serif;
        }
        .font-orbitron {
          font-family: 'Orbitron', sans-serif;
        }
        .animate-fadeIn {
          animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-fadeInUp {
          animation: fadeInUp 1s ease-out forwards;
        }
        .animate-bounce {
          animation: bounce 1s infinite;
        }
        .animate-pulse {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-ping {
          animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        .animate-blob {
          animation: blob 7s infinite;
        }
        .animation-delay-2000 {
          animation-delay: 2s;
        }
        .animation-delay-4000 {
          animation-delay: 4s;
        }
        .delay-1000 {
          animation-delay: 1s;
        }
        .animate-scaleIn {
          animation: scaleIn 0.3s ease-out forwards;
        }
        .animate-spin-slow {
          animation: spin 10s linear infinite;
        }
        .drop-shadow-lg {
          filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.5));
        }
        .shadow-inner-lg {
          box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6);
        }
        .border-gradient-to-br {
          border-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
          border-image-slice: 1;
        }
        .animate-pulse-light {
          animation: pulse-light 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-glow {
          animation: glow 1.5s ease-in-out infinite alternate;
        }
        .animate-beat {
          animation: beat 1s infinite alternate;
        }

        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(-25%);
            animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
          }
          50% {
            transform: translateY(0);
            animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
          }
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: .5; }
        }
        @keyframes ping {
          75%, 100% {
            transform: scale(2);
            opacity: 0;
          }
        }
        @keyframes blob {
          0% {
            transform: translate(0px, 0px) scale(1);
          }
          33% {
            transform: translate(30px, -50px) scale(1.1);
          }
          66% {
            transform: translate(-20px, 20px) scale(0.9);
          }
          100% {
            transform: translate(0px, 0px) scale(1);
          }
        }
        @keyframes scaleIn {
          from { opacity: 0; transform: scale(0.8); }
          to { opacity: 1; transform: scale(1); }
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        @keyframes pulse-light {
          0%, 100% { transform: scale(1); opacity: 0.7; }
          50% { transform: scale(1.05); opacity: 1; }
        }
        @keyframes glow {
          from { box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #fff, 0 0 20px #fff; }
          to { box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff, 0 0 40px #fff; }
        }
        @keyframes beat {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.1); }
        }

        /* Custom scrollbar for the console log and chat */
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #333;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #888;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #555;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-950 to-black text-gray-200 font-inter flex items-center justify-center p-4 relative">
    <!-- Removed overflow-hidden from body to allow scrolling -->

    <!-- Background glowing particles/shapes for avant-garde sci-fi feel -->
    <div class="absolute top-1/4 left-1/4 w-48 h-48 bg-purple-600 rounded-full mix-blend-lighten filter blur-3xl opacity-20 animate-blob"></div>
    <div class="absolute bottom-1/3 right-1/4 w-64 h-64 bg-cyan-600 rounded-full mix-blend-lighten filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-56 h-56 bg-pink-600 rounded-full mix-blend-lighten filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>

    <!-- Subtle background grid/circuit pattern -->
    <div class="absolute inset-0 z-0 opacity-10" style="
      background-image: linear-gradient(to right, #333 1px, transparent 1px), linear-gradient(to bottom, #333 1px, transparent 1px);
      background-size: 20px 20px;
    "></div>

    <!-- Main content container -->
    <div id="main-content" class="relative z-10 w-full max-w-3xl bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-700 p-8 md:p-12 flex flex-col items-center text-center transform transition-all duration-500 ease-in-out scale-95 hover:scale-100 border-t-4 border-l-4 border-gradient-to-br from-purple-500 to-cyan-500">

        <!-- Console/Boot-up Area -->
        <div id="console-log" class="w-full bg-gray-900 text-green-400 font-mono text-left p-6 rounded-lg border border-gray-700 mb-8 max-h-60 overflow-y-auto custom-scrollbar shadow-inner-lg">
            <!-- Console messages will be inserted here by JavaScript -->
        </div>
        <span id="console-cursor" class="inline-block w-2 h-4 bg-green-400 animate-pulse ml-1"></span>

        <!-- Main Birthday Message Area -->
        <div id="birthday-message-area" class="opacity-0">
            <h1 class="text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-yellow-300 mb-6 leading-tight drop-shadow-lg">
                INTERGALACTIC TRANSMISSION: HAPPY BIRTHDAY, TEBOHO!
                <span class="inline-block ml-4 text-yellow-300 animate-bounce" data-lucide="sparkles" style="width: 48px; height: 48px;"></span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-300 mb-8 leading-relaxed">
                May your Earth-cycle be filled with joy, laughter, and cosmic wonders!
                You're truly a stellar phenomenon!
            </p>
            <div class="flex items-center justify-center space-x-4 mb-8">
                <span class="text-purple-400 animate-pulse" data-lucide="rocket" style="width: 40px; height: 40px;"></span>
                <span class="text-3xl text-cyan-400 font-bold">
                    A Galactic Celebration Just For You!
                </span>
                <span class="text-pink-400 animate-ping" data-lucide="satellite" style="width: 40px; height: 40px;"></span>
            </div>
            <p class="text-lg text-gray-400 italic">
                â€” Transmitted from a distant star system by Mvuyelwa
            </p>

            <!-- Buttons for additional features -->
            <div class="mt-8 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 flex-wrap gap-4">
                <button id="interstellar-message-btn" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-full shadow-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center border border-purple-400 min-w-[200px]">
                    <span data-lucide="message-square" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Interstellar Message Log
                </button>
                <button id="chatbot-btn" class="px-6 py-3 bg-gradient-to-r from-cyan-600 to-teal-600 text-white font-bold rounded-full shadow-lg hover:from-cyan-700 hover:to-teal-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center border border-cyan-400 min-w-[200px]">
                    <span data-lucide="bot" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Query Birthday Bot
                </button>
                <button id="memory-crystal-btn" class="px-6 py-3 bg-gradient-to-r from-pink-600 to-red-600 text-white font-bold rounded-full shadow-lg hover:from-pink-700 hover:to-red-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center border border-pink-400 min-w-[200px]">
                    <span data-lucide="gem" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Activate Memory Crystal
                </button>
                <button id="cosmic-prophecy-btn" class="px-6 py-3 bg-gradient-to-r from-yellow-600 to-orange-600 text-white font-bold rounded-full shadow-lg hover:from-yellow-700 hover:to-orange-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center border border-yellow-400 min-w-[200px]">
                    <span data-lucide="lightbulb" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Consult Cosmic Oracle
                </button>
            </div>
        </div>
    </div>

    <!-- Modals (hidden by default, shown by JS) -->
    <!-- Interstellar Message Log Modal -->
    <div id="interstellar-message-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn hidden">
        <div class="bg-gray-800 bg-opacity-90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-700 p-8 max-w-xl w-full text-center relative transform scale-95 animate-scaleIn border-t-4 border-l-4 border-gradient-to-br from-purple-500 to-cyan-500">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-2xl font-bold" onclick="hideModal('interstellar-message-modal')">
                &times;
            </button>
            <h2 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-yellow-300 mb-6 drop-shadow-lg">
                Interstellar Message Log
            </h2>
            <div class="text-left text-gray-300 mb-6 border border-gray-700 rounded-lg p-4 bg-gray-900 overflow-y-auto max-h-[60vh] custom-scrollbar">
                <p class="text-lg font-bold text-cyan-400 mb-2 flex items-center">
                    <span data-lucide="terminal" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Log Entry: Primary Birthday Transmission
                </p>
                <p class="mb-4">
                    Origin: Mvuyelwa_OS, Sector Xylo-7. Destination: Teboho, Planet Earth.
                    <br />
                    Message: May your Earth-cycle be filled with joy, laughter, and cosmic wonders! You're truly a stellar phenomenon!
                </p>
                <div class="w-full h-px bg-gray-700 my-4"></div>
                <p class="text-lg font-bold text-purple-400 mb-2 flex items-center">
                    <span data-lucide="satellite" style="width: 20px; height: 20px;" class="mr-2"></span>
                    Personal Log Entry from Mvuyelwa
                </p>
                <p class="text-xl leading-relaxed">
                    Greetings, Teboho, from across the cosmic expanse!
                    <br /><br />
                    This transmission carries my warmest wishes for your current orbital completion.
                    I've calibrated these digital constructs to manifest a celebration worthy of your unique stellar signature.
                    <br /><br />
                    Now, I know what you're thinking: "Mvuyelwa, did you really send this from a dimension where socks never get lost in the laundry?" And the answer is... perhaps! The quantum entanglement of birthday wishes is a mysterious thing.
                    <br /><br />
                    May your personal universe expand with boundless joy, uncharted adventures (hopefully without any rogue asteroids), and vibrant, nebular happiness. May your coffee always be perfectly brewed, your Wi-Fi signal strong, and your alien encounters be of the friendly, gift-bearing kind.
                    <br /><br />
                    Your presence illuminates the void, and I am grateful for our shared trajectory. Seriously, you're cooler than a black hole in a freezer.
                    <br /><br />
                    End Transmission.
                    <br />
                    â€” Mvuyelwa, Operative of the Star-Bound Sentience (and occasional cosmic comedian)
                </p>
            </div>
            <span class="text-yellow-300 mx-auto animate-spin-slow" data-lucide="sparkles" style="width: 32px; height: 32px;"></span>
        </div>
    </div>

    <!-- Chatbot Modal -->
    <div id="chatbot-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn hidden">
        <div class="bg-gray-800 bg-opacity-90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-700 p-8 max-w-md w-full h-3/4 flex flex-col relative transform scale-95 animate-scaleIn border-t-4 border-l-4 border-gradient-to-br from-cyan-500 to-teal-500">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-2xl font-bold" onclick="hideModal('chatbot-modal')">
                &times;
            </button>
            <h2 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-teal-300 mb-6 flex items-center justify-center drop-shadow-lg">
                <span data-lucide="bot" style="width: 32px; height: 32px;" class="mr-2"></span> Birthday Bot AI
            </h2>

            <!-- Chat messages display area -->
            <div id="chat-messages-display" class="flex-1 overflow-y-auto custom-scrollbar p-4 mb-4 bg-gray-900 rounded-lg border border-gray-700">
                <p class="text-gray-500 text-center italic">
                    Greetings, Earthling! This is the Birthday Bot. Query me about anything related to your celebration or the cosmos!
                </p>
                <!-- Chat messages will be inserted here by JavaScript -->
            </div>

            <!-- Chat input area -->
            <div class="flex mt-auto">
                <input type="text" id="chat-input" placeholder="Transmit your query..." class="flex-1 p-3 rounded-l-full bg-gray-700 text-gray-200 placeholder-gray-400 border border-gray-600 focus:outline-none focus:border-cyan-500" />
                <button id="send-chat-btn" class="px-5 py-3 bg-gradient-to-r from-cyan-600 to-teal-600 text-white rounded-r-full hover:from-cyan-700 hover:to-teal-700 transition-all duration-300 flex items-center justify-center">
                    <span data-lucide="send" style="width: 20px; height: 20px;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Memory Crystal Activation Modal -->
    <div id="memory-crystal-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn hidden">
        <div class="bg-gray-800 bg-opacity-90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-700 p-8 max-w-lg w-full text-center relative transform scale-95 animate-scaleIn border-t-4 border-l-4 border-gradient-to-br from-pink-500 to-red-500">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-2xl font-bold" onclick="hideModal('memory-crystal-modal')">
                &times;
            </button>
            <h2 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-red-300 mb-6 flex items-center justify-center drop-shadow-lg">
                <span data-lucide="gem" style="width: 40px; height: 40px;" class="mr-3 animate-spin-slow"></span>
                Memory Crystal Projection
            </h2>

            <div id="memory-crystal-display" class="relative w-full max-w-[200px] sm:max-w-[250px] aspect-square mx-auto mb-8 cursor-pointer transform hover:scale-105 transition-transform duration-300">
                <!-- Crystal base shape -->
                <div class="absolute inset-0 bg-gradient-to-br from-blue-400 to-purple-600 rounded-full opacity-70 animate-pulse-light"></div>
                <div class="absolute inset-2 bg-gradient-to-br from-blue-300 to-purple-500 rounded-full opacity-80 animate-pulse-light animation-delay-500"></div>
                <div class="absolute inset-4 bg-gradient-to-br from-blue-200 to-purple-400 rounded-full opacity-90 animate-pulse-light animation-delay-1000"></div>
                <div class="absolute inset-6 bg-gradient-to-br from-blue-100 to-purple-300 rounded-full opacity-100 animate-pulse-light animation-delay-1500"></div>

                <!-- Central glow -->
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-2/3 h-2/3 bg-white rounded-full filter blur-xl opacity-50 animate-glow"></div>
                </div>
                <div class="absolute inset-0 flex items-center justify-center text-white text-5xl sm:text-6xl font-bold">
                    <span data-lucide="heart" style="width: 64px; height: 64px;" class="text-pink-400 animate-beat"></span>
                </div>
            </div>

            <p id="memory-fragment-text" class="text-xl text-gray-300 italic mb-6 animate-fadeInUp delay-500 overflow-y-auto max-h-[20vh] custom-scrollbar">
                <!-- Memory fragment text will be inserted here by JavaScript -->
            </p>
            <p class="text-sm text-gray-500">
                Click the crystal to reveal another memory fragment.
            </p>
            <span class="text-yellow-300 mx-auto mt-6 animate-spin-slow" data-lucide="sparkles" style="width: 32px; height: 32px;"></span>
        </div>
    </div>

    <!-- Cosmic Prophecy Modal -->
    <div id="cosmic-prophecy-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn hidden">
        <div class="bg-gray-800 bg-opacity-90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-700 p-8 max-w-lg w-full text-center relative transform scale-95 animate-scaleIn border-t-4 border-l-4 border-gradient-to-br from-yellow-500 to-orange-500">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-2xl font-bold" onclick="hideModal('cosmic-prophecy-modal')">
                &times;
            </button>
            <h2 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-300 mb-6 flex items-center justify-center drop-shadow-lg">
                <span data-lucide="lightbulb" style="width: 40px; height: 40px;" class="mr-3 animate-pulse"></span>
                Cosmic Prophecy
            </h2>

            <div id="prophecy-content">
                <div id="prophecy-loading" class="flex flex-col items-center justify-center h-48 hidden">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-yellow-500"></div>
                    <p class="mt-4 text-xl text-gray-300">Consulting the Cosmic Oracle...</p>
                </div>
                <p id="prophecy-text" class="text-xl text-gray-300 leading-relaxed mb-6 overflow-y-auto max-h-[40vh] custom-scrollbar">
                    <!-- Prophecy text will be inserted here by JavaScript -->
                </p>
            </div>
            <span class="text-yellow-300 mx-auto mt-6 animate-spin-slow" data-lucide="sparkles" style="width: 32px; height: 32px;"></span>
        </div>
    </div>

    <script>
        // Lucide icons replacement
        lucide.createIcons();

        // --- Global Variables and DOM Elements ---
        const consoleLogElement = document.getElementById('console-log');
        const consoleCursor = document.getElementById('console-cursor');
        const birthdayMessageArea = document.getElementById('birthday-message-area');

        const interstellarMessageBtn = document.getElementById('interstellar-message-btn');
        const chatbotBtn = document.getElementById('chatbot-btn');
        const memoryCrystalBtn = document.getElementById('memory-crystal-btn');
        const cosmicProphecyBtn = document.getElementById('cosmic-prophecy-btn');

        const interstellarMessageModal = document.getElementById('interstellar-message-modal');
        const chatbotModal = document.getElementById('chatbot-modal');
        const memoryCrystalModal = document.getElementById('memory-crystal-modal');
        const cosmicProphecyModal = document.getElementById('cosmic-prophecy-modal');

        const chatMessagesDisplay = document.getElementById('chat-messages-display');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');

        const memoryCrystalDisplay = document.getElementById('memory-crystal-display');
        const memoryFragmentText = document.getElementById('memory-fragment-text');

        const prophecyLoading = document.getElementById('prophecy-loading');
        const prophecyTextElement = document.getElementById('prophecy-text');

        let currentLogIndex = 0;
        let bootUpComplete = false;
        let chatMessages = [];
        let currentMemoryIndex = 0;
        let isChatLoading = false;
        let isProphecyLoading = false;

        // --- Data Arrays ---
        const bootUpMessages = [
            "INITIATING INTERGALACTIC TRANSMISSION PROTOCOL...",
            "ESTABLISHING SECURE QUANTUM LINK TO SECTOR TEBOHO-7...",
            "DECRYPTING CELEBRATION ENCRYPTIONS FROM MVUYELWA_OS...",
            "AUTHENTICATING RECIPIENT: TEBOHO, RESIDENT OF PLANET EARTH...",
            "VERIFYING TRANSMISSION INTEGRITY: 100%...",
            "CALIBRATING VISUAL DISPLAY FOR OPTIMAL RECEPTION...",
            "PREPARING COSMIC SURPRISE SEQUENCE...",
            "TRANSMISSION COMPLETE. DISPLAYING PRIMARY MESSAGE."
        ];

        const memoryFragments = [
            "Memory Fragment 001: Your laughter is truly infectious, brightening up any cosmic journey. It's almost as loud as a black hole burping!",
            "Memory Fragment 002: Grateful for every moment we've navigated this galaxy together as friends. Each one, a shining star. Even that time we almost got sucked into a wormhole trying to find the best pizza.",
            "Memory Fragment 003: Your brilliance and kindness shine brighter than any supernova, Teboho. Never forget how amazing you are. Seriously, sunglasses are recommended when you enter a room.",
            "Memory Fragment 004: Our shared adventures and inside jokes are etched into the very fabric of spacetime. More fun to come! Maybe next time we'll find a planet made entirely of chocolate.",
            "Memory Fragment 005: May your journey through the cosmos be as extraordinary as your friendship. Happy Birthday! And remember, if you ever meet an alien, ask if they have Wi-Fi."
        ];

        // --- Utility Functions ---
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function appendConsoleLog(message) {
            const p = document.createElement('p');
            p.className = 'mb-1 animate-fadeIn';
            p.innerHTML = `<span data-lucide="terminal" style="width: 16px; height: 16px;" class="inline-block mr-2 text-purple-400"></span>${message}`;
            consoleLogElement.appendChild(p);
            // Re-render Lucide icons for newly added elements
            lucide.createIcons();
            consoleLogElement.scrollTop = consoleLogElement.scrollHeight; // Scroll to bottom
        }

        function appendChatMessage(role, text) {
            const div = document.createElement('div');
            div.className = `mb-3 flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            const innerDiv = document.createElement('div');
            innerDiv.className = `p-3 rounded-xl max-w-[80%] ${
                role === 'user' ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-gray-700 text-gray-200 rounded-bl-none'
            }`;
            innerDiv.textContent = text;
            div.appendChild(innerDiv);
            chatMessagesDisplay.appendChild(div);
            chatMessagesDisplay.scrollTop = chatMessagesDisplay.scrollHeight; // Scroll to bottom
        }

        // --- Core Logic ---

        // Boot-up sequence
        function startBootUpSequence() {
            if (currentLogIndex < bootUpMessages.length) {
                appendConsoleLog(bootUpMessages[currentLogIndex]);
                currentLogIndex++;
                setTimeout(startBootUpSequence, 500);
            } else {
                bootUpComplete = true;
                consoleCursor.classList.add('hidden');
                setTimeout(() => {
                    birthdayMessageArea.classList.remove('opacity-0');
                    birthdayMessageArea.classList.add('animate-fadeInUp');
                }, 1000);
            }
        }

        // Chatbot functionality
        async function handleSendMessage() {
            if (isChatLoading) return;
            const message = chatInput.value.trim();
            if (message === '') return;

            appendChatMessage('user', message);
            chatMessages.push({ role: 'user', parts: [{ text: message }] });
            chatInput.value = '';
            isChatLoading = true;
            chatInput.disabled = true;
            sendChatBtn.disabled = true;

            appendChatMessage('bot', 'Bot processing data...'); // Loading indicator

            try {
                const payload = { contents: chatMessages };
                const apiKey = ""; // Canvas will inject this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                // Remove loading message
                chatMessagesDisplay.lastChild.remove();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    appendChatMessage('bot', botResponse);
                    chatMessages.push({ role: 'model', parts: [{ text: botResponse }] });
                } else {
                    appendChatMessage('bot', "Error: Could not get a response. Transmission interference detected.");
                }
            } catch (error) {
                console.error("Error communicating with Gemini API:", error);
                // Remove loading message
                chatMessagesDisplay.lastChild.remove();
                appendChatMessage('bot', "Error: Failed to connect to the intergalactic network.");
            } finally {
                isChatLoading = false;
                chatInput.disabled = false;
                sendChatBtn.disabled = false;
                chatInput.focus();
            }
        }

        // Memory Crystal functionality
        function handleActivateMemoryCrystal() {
            showModal('memory-crystal-modal');
            currentMemoryIndex = 0;
            memoryFragmentText.textContent = memoryFragments[currentMemoryIndex];
        }

        function showNextMemory() {
            currentMemoryIndex = (currentMemoryIndex + 1) % memoryFragments.length;
            memoryFragmentText.textContent = memoryFragments[currentMemoryIndex];
        }

        // Cosmic Prophecy functionality
        async function generateCosmicProphecy() {
            showModal('cosmic-prophecy-modal');
            prophecyTextElement.textContent = ''; // Clear previous prophecy
            prophecyLoading.classList.remove('hidden'); // Show loading spinner
            prophecyTextElement.classList.add('hidden'); // Hide text area

            isProphecyLoading = true;

            try {
                const prompt = "Generate a quirky, positive, sci-fi themed birthday prophecy for Teboho, including elements of space travel, new discoveries, joy, and maybe a humorous alien encounter. Keep it around 100-150 words.";
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];

                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will inject this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    prophecyTextElement.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    prophecyTextElement.textContent = "Prophecy transmission failed. Cosmic dust interference detected!";
                }
            } catch (error) {
                console.error("Error generating prophecy:", error);
                prophecyTextElement.textContent = "Prophecy generator offline. Check intergalactic power grid.";
            } finally {
                isProphecyLoading = false;
                prophecyLoading.classList.add('hidden'); // Hide loading spinner
                prophecyTextElement.classList.remove('hidden'); // Show text area
            }
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', startBootUpSequence);

        interstellarMessageBtn.addEventListener('click', () => showModal('interstellar-message-modal'));
        chatbotBtn.addEventListener('click', () => showModal('chatbot-modal'));
        memoryCrystalBtn.addEventListener('click', handleActivateMemoryCrystal);
        cosmicProphecyBtn.addEventListener('click', generateCosmicProphecy);

        sendChatBtn.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        memoryCrystalDisplay.addEventListener('click', showNextMemory);

    </script>
</body>
</html>
